<!doctype html>

<head>
  <meta charset='utf8'>
  <link rel='icon' href='data:,'>
  <title>Dispose</title>
  <style>
    canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      cursor: grab;
    }

    button {
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 1;
      padding: 1ch;
    }

    .hide {
      display: none;
    }
  </style>
  <script type='module' defer>

    import * as THREE from '//cdn.skypack.dev/three@0.132?min'
    import { OrbitControls } from '//cdn.skypack.dev/three@0.132/examples/jsm/controls/OrbitControls?min'
    import { Strip } from '../../build/three-strip.js'

    const renderer = new THREE.WebGLRenderer();
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, 2, .1, 100);
    const controls = new OrbitControls(camera, renderer.domElement);

    scene.background = new THREE.Color('white');
    camera.position.set(0, 2, 2);
    controls.enableDamping = true;

    const light = new THREE.DirectionalLight();
    scene.add(light);

    scene.add(new THREE.GridHelper());

    // ----
    // Strip
    // ----

    Strip.THREE = THREE;

    const curve = new THREE.CatmullRomCurve3([
      new THREE.Vector3(-1, 0, 0),
      new THREE.Vector3(0, 1, 0),
      new THREE.Vector3(1, 0, 0),
    ]);

    let strip = new Strip(curve, 10000, 0.5, 0, Strip.UvFns[0]);

    const mat = new THREE.MeshLambertMaterial({ color: 'cyan', side: THREE.DoubleSide });
    let mesh = new THREE.Mesh(strip.geometry, mat);
    scene.add(mesh);

    let helper = new Strip.Helper(strip, 0.2);
    scene.add(helper);

    // ----
    // button
    // ----

    const btn = document.querySelector('button');
    btn.classList.remove('hide'); // show
    btn.addEventListener('pointerdown', () => {

      scene.remove(mesh);
      mesh = null;

      strip.dispose(); // dispose strip.geometry
      strip = null;

      mat.dispose(); // dispose material

      scene.remove(helper);
      helper.dispose(); // dispose helper.goemetry and helper.material
      helper = null;

      btn.classList.add('hide'); // hide

    }, { once: true });

    // ----
    // render
    // ----

    renderer.setAnimationLoop(() => {
      renderer.render(scene, camera);
      controls.update();
    });

    // ----
    // view
    // ----

    function resize(w, h, dpr = devicePixelRatio) {
      renderer.setPixelRatio(dpr);
      renderer.setSize(w, h, false);
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
    }
    addEventListener('resize', () => resize(innerWidth, innerHeight));
    dispatchEvent(new Event('resize'));
    document.body.prepend(renderer.domElement);

  </script>
</head>

<body>
  <button class='hide'>Click here to dispose mesh, strip and its helper</button>
</body>